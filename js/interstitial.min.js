(function(w,d,$,wpAd){"use strict";wpAd=wpAd||{};var $head=$("head"),$body=$("body"),$html=$("html"),$window=$(w),default_config={creative:null,creativeType:null,width:760,height:425,timeOpen:15,clickTrack:"",clickTag:"",pixels:false,customFlashVars:false,creativeBGColor:"#fff",bgcolor:"#fff",opacity:1,shadow:true,blur:true,siteOverride:false,quartileTracking:false,wrapperID:"interstitial_ad",adid:null};if(!Function.prototype.bind)Function.prototype.bind=function(oThis){if(typeof this!=="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,FNOP=function(){},fBound=function(){return fToBind.apply(this instanceof FNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};FNOP.prototype=this.prototype;fBound.prototype=new FNOP;return fBound};function Interstitial(config){this.config=$.extend(true,default_config,config);this.creativeCode=this.buildCreative();this.$wrapper=this.buildWrapper();this.$counter=$("span.counter",this.$wrapper);this.$header=$("div.ad-interstitial-header",this.$wrapper);this.$intbody=$("div.ad-interstitial-body",this.$wrapper);this.$creativeContainer=$("div.ad-interstitial-creative-container",this.$wrapper);this.site=this.getSite();this.render();return this}Interstitial.prototype.getSite=function(){return this.config.siteOverride||wpAd.constants&&wpAd.constants.domain||w.wpniDomain||"generic"};Interstitial.prototype.render=function(){this.addSiteClass().bindEvents().styleOverlay().addInterstitial().startTimer().addTracking()};Interstitial.prototype.addInterstitial=function(){$html.addClass("has-interstitial");$body.append(this.$wrapper);return this};Interstitial.prototype.buildCreative=function(){if(this.config.creativeType==="flash"){this.flashvars=this.buildFlashVars();return this.buildSWFCreative()}else if(this.config.creativeType==="iframe"){return this.buildIframeCreative()}else if(this.config.creativeType==="image"){return this.buildImageCreative()}else if(this.config.creativeType==="custom"){return this.config.creative}};Interstitial.prototype.buildWrapper=function(){return $('<div id="'+this.config.wrapperID+'" class="ad-interstitial">'+'<div class="ad-interstitial-cover"></div>'+'<div class="ad-interstitial-inner">'+'<div class="ad-interstitial-header shadow-narrow">'+'<div class="ad-col ad-col-25">'+'<div class="ad-logo"></div>'+"</div>"+'<div class="ad-col ad-col-50">'+'<div class="ad-message">'+'<span class="bold">Advertisement | </span>'+'The page you requested will appear in <span class="counter">'+this.config.timeOpen+"</span> seconds"+"</div>"+"</div>"+'<div class="ad-img-right ad-col ad-col-25">'+'<div class="ad-close bold">'+"CLOSE [X]"+"</div>"+"</div>"+"</div>"+'<div class="ad-interstitial-body">'+'<div class="ad-interstitial-creative-container">'+this.creativeCode+"</div>"+"</div>"+"</div>"+"</div>")};Interstitial.prototype.addSiteClass=function(){var classes={"washingtonpost.com":"wp-int","slate.com":"slate-int","theroot.com":"root-int"};if(classes[this.site]){this.$wrapper.addClass(classes[this.site])}return this};Interstitial.prototype.bindEvents=function(){$("div.ad-close",this.$wrapper).bind("click.interstitial",this.close.bind(this));$window.bind("resize.interstitial",this.alignMiddle.bind(this));return this};Interstitial.prototype.unbindEvents=function(){$("div.ad-close",this.$wrapper).unbind(".interstitial");$window.unbind(".interstitial")};Interstitial.prototype.alignMiddle=function(){var offset=($window.height()-this.$header.outerHeight()-this.config.height)/2;this.$creativeContainer.css({top:(offset>0?offset:0)+"px"});return this};Interstitial.prototype.styleOverlay=function(){this.alignMiddle();this.$creativeContainer.css({width:this.config.width+"px",backgroundColor:this.config.creativeBGColor});if(this.config.opacity<1){if(this.config.shadow){this.$creativeContainer.addClass("shadow-wide")}if(this.config.blur){$html.addClass("interstitial-blur")}}$("div.ad-interstitial-cover",this.$wrapper).css({backgroundColor:this.config.bgcolor,opacity:this.config.opacity});return this};Interstitial.prototype.close=function(){this.clearTimer();this.showFlashAds();$html.removeClass("has-interstitial interstitial-blur");this.unbindEvents();this.$wrapper.remove()};Interstitial.prototype.buildIframeCreative=function(){return'<iframe src="'+this.config.creative+'" width="'+this.config.width+'" height="'+this.config.height+'" frameborder="0" marginheight="0" marginwidth="0" scrolling="no"></iframe>'};Interstitial.prototype.buildFlashVars=function(){var vars=[];if(this.config.clickTag){vars.push("clickTag="+this.config.clickTrack+this.config.clickTag)}if(this.config.customFlashVars){for(var key in this.config.customFlashVars){if(this.config.customFlashVars.hasOwnProperty(key)){vars.push(key+"="+this.config.customFlashVars[key])}}}if(this.config.quartileTracking){var i=0,l=this.config.quartileTracking.length,s=100/l;for(i;i<l;i++){if(this.config.quartileTracking[i]){vars.push("track"+s*(i+1)+"percent="+encodeURIComponent(this.config.quartileTracking[i]))}}}return vars.join("&")};Interstitial.prototype.buildSWFCreative=function(){return'<object id="intFlashCreative" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.config.width+'" height="'+this.config.height+'">'+'<param name="movie" value="'+this.config.creative+'" />'+'<param name="quality" value="high" />'+'<param name="wmode" value="window" />'+'<param name="menu" value="false" />'+'<param name="allowfullscreen" value="false" />'+'<param name="allowScriptAccess" value="always" />'+'<param name="flashVars" value="'+this.flashvars+'" />'+"<!--[if !IE]>-->"+'<object id="intFlashCreativex" type="application/x-shockwave-flash" data="'+this.config.creative+'" width="'+this.config.width+'" height="'+this.config.height+'">'+'<param name="movie" value="'+this.config.creative+'" />'+'<param name="quality" value="high" />'+'<param name="wmode" value="window" />'+'<param name="menu" value="false" />'+'<param name="allowfullscreen" value="false" />'+'<param name="allowScriptAccess" value="always" />'+'<param name="flashVars" value="'+this.flashvars+'" />'+"</object>"+"<!--<![endif]-->"+"</object>"};Interstitial.prototype.buildImageCreative=function(){return'<a href="'+this.config.clickTrack+this.config.clickTag+'" target="_blank">'+'<img src="'+this.config.creative+'" width="'+this.config.width+'" height="'+this.config.height+'" alt="" />'+"</a>"};Interstitial.prototype.startTimer=function(){this.timer=setTimeout(this.updateTimer.bind(this),1e3);return this};Interstitial.prototype.updateTimer=function(){this.config.timeOpen--;this.$counter.html(this.config.timeOpen);if(this.config.timeOpen){this.startTimer()}else{this.close()}};Interstitial.prototype.clearTimer=function(){clearTimeout(this.timer)};Interstitial.prototype.showFlashAds=function(){$("object, embed",'[id^="slug_"]').each(function(i,el){var mov_src=$(this).attr("src");if(mov_src){$(this).attr({src:"#"}).attr({src:mov_src})}$(this).find('param[name="movie"]').each(function(i,el){var param_mov_src=$(this).attr("value");$(this).attr({value:"#"}).attr({value:param_mov_src})});$(this).css({visibility:"",position:""})})};Interstitial.prototype.addTracking=function(){if(this.config.pixels){var l=this.config.pixels.length;while(l--){this.addPixel(this.config.pixels[l])}}return this};Interstitial.prototype.addPixel=function(url){if(url){this.rndm=this.rndm||Math.floor(Math.random()*1e6);$body.append('<img src="'+url.replace(/\[random\]|\[timestamp\]i/,this.rndm)+'" width="1" height="1" style="display:none;" />')}};wpAd.Interstitial=Interstitial})(window,document,window.jQuery,window.wpAd);